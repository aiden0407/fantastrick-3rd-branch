<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>disinfecting-room</title>
  <script src="../jquery.min.js" type='text/javascript'></script>
  <!-- 공통 arduinoContainer CSS 부분 -->
  <link rel="stylesheet" href="../style.css" />
  <link rel="stylesheet" href="./styles.css" />
</head>

<body>
  <div id="overlay">연결이 끊겼습니다.</div>
  <div id="arduinoContainer"></div>
  <div id="hitContainer"></div>
  <div id="wrongOverlay"></div>

  <div id="section0"
    style="width:100%; height:100dvh; display: flex; justify-content: center; align-items: center; color: red; font-size: 40px;">
    정상적인 초기화를 위해 화면을 터치해 주세요
  </div>

  <div id="section1" class="section">
    <img src="./img/initialpage_button.png" alt="initialpage_button" id="initialpage_button"
      style="width: 30%; cursor: pointer;">
  </div>

  <div id="section2" class="section">
    <img src="./img/closedoormessage.png" alt="closedoormessage" style="width: 95%;">
  </div>

  <div id="section3" class="section" style="justify-content: center; align-items: center; gap: 20px;">
    <div style="width: 40.3%;">
      <div style="width: 100%; position: relative; display: flex; justify-content: center; align-items: center;">
        <img src="./img/mainpage_left_textboard.png" alt="mainpage_left_textboard" style="width: 100%;">
        <img src="./img/eqip_pic1.png" alt="eqip_pic1" style="width: 90%; position: absolute; bottom: 5%;">
      </div>
    </div>
    <div style="display: flex; width: 45%; flex-direction: column; gap: 20px;">
      <img class="main-btn" id="mainpage_button1" data-base="mainpage_button1" src="./img/mainpage_button1.png"
        alt="mainpage_button1" />
      <img class="main-btn" id="mainpage_button2" data-base="mainpage_button2" src="./img/mainpage_button2.png"
        alt="mainpage_button2" />
      <img class="main-btn" id="mainpage_button3" data-base="mainpage_button3" src="./img/mainpage_button3.png"
        alt="mainpage_button3" />
    </div>

    <div id="warning-popup1" class="popup">
      <img src="./img/mainpage_popup.png" alt="mainpage_popup" style="width: 70%;">
    </div>
    <div id="warning-popup2" class="popup">
      <img src="./img/itemvault_popup.png" alt="itemvault_popup" style="width: 70%;">
    </div>
    <div id="warning-popup3" class="popup">
      <img src="./img/internaldisinfect_popup.png" alt="internaldisinfect_popup" style="width: 70%;">
    </div>
    <div id="warning-popup4" class="popup">
      <img src="./img/itermdisinfect_popup.png" alt="itermdisinfect_popup" style="width: 70%;">
    </div>
  </div>

  <div id="main1" class="section" style="gap: 3%;">
    <div style="display: flex; width: 45%; flex-direction: column; gap: 40px;">
      <img src="./img/itemvault_left_title.png" alt="itemvault_left_title" style="width: 100%;">
      <div style="width: 100%; position: relative; display: flex; justify-content: center; align-items: center;">
        <img src="./img/itemvault_left_base.png" alt="itemvault_left_base" style="width: 100%;">
        <img src="./img/eqip_pic2.png" alt="eqip_pic2" style="width: 90%; position: absolute; bottom: 8%;">
      </div>
    </div>
    <div style="width: 45%; position: relative; display: flex; justify-content: center; align-items: center;">
      <img src="./img/itemvault_right_base.png" alt="itemvault_right_base" style="width: 100%;">
      <div style="width: 90%; position: absolute; bottom: 8%; gap: 20px; display: flex; flex-direction: column;">
        <div style="display: flex; gap: 20px;">
          <img class="main1-btn" id="itemvault_button_1-1" data-base="itemvault_button_1-1"
            src="./img/itemvault_button_1-1.png" alt="itemvault_button_1-1" />
          <img class="main1-btn" id="itemvault_button_1-2" data-base="itemvault_button_1-2"
            src="./img/itemvault_button_1-2.png" alt="itemvault_button_1-2" />
        </div>
        <div style="display: flex; gap: 20px;">
          <img class="main1-btn" id="itemvault_button_2-1" data-base="itemvault_button_2-1"
            src="./img/itemvault_button_2-1.png" alt="itemvault_button_2-1" />
          <img class="main1-btn" id="itemvault_button_2-2" data-base="itemvault_button_2-2"
            src="./img/itemvault_button_2-2.png" alt="itemvault_button_2-2" />
        </div>
        <div style="display: flex; gap: 20px;">
          <img class="main1-btn" id="itemvault_button_3-1" data-base="itemvault_button_3-1"
            src="./img/itemvault_button_3-1.png" alt="itemvault_button_3-1" />
          <img class="main1-btn" id="itemvault_button_3-2" data-base="itemvault_button_3-2"
            src="./img/itemvault_button_3-2.png" alt="itemvault_button_3-2" />
        </div>
        <div style="display: flex; gap: 20px;">
          <img class="main1-btn" id="itemvault_button_4-1" data-base="itemvault_button_4-1"
            src="./img/itemvault_button_4-1.png" alt="itemvault_button_4-1" />
          <img class="main1-btn" id="itemvault_button_4-2" data-base="itemvault_button_4-2"
            src="./img/itemvault_button_4-2.png" alt="itemvault_button_4-2" />
        </div>

      </div>
    </div>
  </div>
  <div id="equip_1page" class="section">
    <img src="./img/itemvault_1page.png" alt="itemvault_1page" style="width: 95%;">
  </div>
  <div id="equip_2page" class="section">
    <img src="./img/itemvault_2page.png" alt="itemvault_2page" style="width: 95%;">
  </div>

  <div id="main2" class="section"
    style="width: 100%; position: relative; justify-content: center; align-items: center;">
    <img src="./img/itemdisinfect_base.png" alt="itemdisinfect_base" style="width: 95%;">
    <div style="display: flex; width: 95%; gap: 40px; position: absolute; justify-content: center;">
      <div style="width: 49%; position: relative; display: flex; justify-content: center; align-items: center;">
        <img src="./img/itemvault_left_base.png" alt="itemvault_left_base" style="width: 100%;">
        <img src="./img/eqip_pic3.png" alt="eqip_pic3" style="width: 90%; position: absolute; bottom: 3%;">
      </div>
      <div style="width: 45%; position: relative; display: flex; justify-content: center; align-items: center;">
        <img src="./img/itemdisinfect_rigt_base.png" alt="itemdisinfect_rigt_base" style="width: 100%;">
        <img src="./img/itemdisinfect_button.png" alt="itemdisinfect_button" id="itemdisinfect_button"
          style="width: 60%; position: absolute; bottom: 20%; cursor: pointer;">
      </div>
    </div>
  </div>
  <div id="main2_complete" class="section">
    <img src="./img/itemdisinfect_message1.png" alt="itemdisinfect_message1" style="width: 95%;">
  </div>
  <div id="main2_complete2" class="section">
    <img src="./img/itemdisinfect_message2.png" alt="itemdisinfect_message2" style="width: 95%;">
  </div>

  <div id="main3" class="section"
    style="width: 100%; position: relative; justify-content: center; align-items: center;">
    <img src="./img/internaldisinfect_base.png" alt="internaldisinfect_base" style="width: 95%;">
    <div style="display: flex; width: 95%; gap: 40px; position: absolute; justify-content: center;">
      <div style="width: 49%; position: relative; display: flex; justify-content: center; align-items: center;">
        <img src="./img/itemvault_left_base.png" alt="itemvault_left_base" style="width: 100%;">
        <img src="./img/eqip_pic3.png" alt="eqip_pic3" style="width: 90%; position: absolute; bottom: 3%;">
      </div>
      <div style="width: 45%; position: relative; display: flex; justify-content: center; align-items: center;">
        <img src="./img/itemdisinfect_rigt_base.png" alt="itemdisinfect_rigt_base" style="width: 100%;">
        <img src="./img/itemdisinfect_button.png" alt="itemdisinfect_button" id="itemdisinfect_button2"
          style="width: 60%; position: absolute; bottom: 20%; cursor: pointer;">
      </div>
    </div>
  </div>
  <div id="main3_complete" class="section">
    <img src="./img/internaldisinfect_message1.png" alt="internaldisinfect_message1" style="width: 95%;">
  </div>
  <div id="main3_complete2" class="section">
    <img src="./img/internaldisinfect_message2.png" alt="internaldisinfect_message2" style="width: 95%;">
  </div>

  <div id="section4" class="section">
    <img src="./img/lastpage.png" alt="lastpage" style="width: 95%;">
  </div>



  <script>
    const bgm = new Audio('./sound/effect/broken.ogg');
    bgm.loop = true;
    const narration2 = new Audio('./sound/narration/narration2.ogg');
    let narration2Interval = null;
    const quarnatine = new Audio('./sound/effect/quarnatine.ogg');
    quarnatine.loop = true;

    let pin22Activated = false;
    let pin23Activated = false;
    let pin23ActivatedOver = false;
    let pin24Activated1 = false;
    let pin24Activated2 = false;
    let pin24ActivatedFinal = false;
    let pin25Activated1 = false;
    let pin25Activated2 = false;
    let pin25ActivatedFinal = false;
    let pin26Activated = false;
    let pin27Activated = false;
    let pin27ActivatedFinal = false;
    let pin28Activated = false;
    let pin28ActivatedFinal = false;
    let pin29Activated = false;
    let pin29ActivatedFinal = false;
    let pin30Activated = false;
    let pin30ActivatedFinal = false;
    let pin31Activated = false;
    let pin32Activated = false;
    let pin33Activated = false;
    let pin34Activated = false;
    let pin35Activated = false;
    let pin36Activated = false;

    let equipCleared = false;

    const pinActions = {
      "disinfectmega-2_pin_22": () => {
        if (!pin22Activated) {
          pin22Activated = true;
          bgm.play();
          triggerPinOnAndOff('disinfectmega-1_pin_42');
          setTimeout(() => {
            triggerPinOnAndOff('disinfectmega-1_pin_41');
          }, 15000);
        }
      },
      "disinfectmega-2_pin_23": () => {
        if (!pin23Activated && !pin26Activated) {
          pin23Activated = true;
          bgm.pause();
          new Audio('./sound/effect/fix.mp3').play();
          setTimeout(() => {
            triggerPinOn('disinfectmega-1_pin_37');
          }, 7000);
          setTimeout(() => {
            triggerPinOff('disinfectmega-1_pin_37');
          }, 8000);
          setTimeout(() => {
            triggerPinOn('disinfectmega-1_pin_37');
          }, 10000);
          setTimeout(() => {
            triggerPinOff('disinfectmega-1_pin_37');
          }, 11000);
          setTimeout(() => {
            triggerPinOn('disinfectmega-1_pin_37');
          }, 12000);
          setTimeout(() => {
            triggerPinOff('disinfectmega-1_pin_37');
          }, 13000);
          setTimeout(() => {
            triggerPinOn('disinfectmega-1_pin_37');
            section1.style.display = "none";
            section2.style.display = "flex";
            pin23ActivatedOver = true;
          }, 13500);
        }
      },
      "disinfectmega-2_pin_24": () => {
        if (!pin24Activated1 && pin23ActivatedOver && !pin26Activated) {
          pin24Activated1 = true;
          triggerPinOnAndOff('disinfectmega-1_pin_39');
          triggerPinOn('disinfectmega-1_pin_29');
          triggerPinOn('disinfectmega-1_pin_43');
          triggerPinOn('disinfectmega-1_pin_49');
          setTimeout(() => {
            new Audio('./sound/narration/narration1.ogg').play();
          }, 15000);
          setTimeout(() => {
            if (narration2Interval !== null) return;
            narration2Interval = setInterval(() => {
              narration2.play();
              // narration2 끝나는 타이밍에 맞춰서 시간 조정
            }, 10000);
            // narration1 끝나는 타이밍에 맞춰서 시간 조정
          }, 20000);
        }

        if (pin27Activated && !pin24Activated2) {
          pin24Activated2 = true;
          if (narration2Interval !== null) {
            clearInterval(narration2Interval);
            narration2Interval = null;
          }
          triggerPinOnAndOff('disinfectmega-1_pin_41');
          new Audio('./sound/effect/complete.mp3').play();
          equip_2page.style.display = "none";
          section4.style.display = "flex";
          setTimeout(() => {
            triggerPinOff('disinfectmega-1_pin_29');
            triggerPinOff('disinfectmega-1_pin_43');
            triggerPinOff('disinfectmega-1_pin_49');
          }, 15000);
        }

        if (pin35Activated && !pin24ActivatedFinal) {
          pin24ActivatedFinal = true;
          triggerPinOnAndOff('disinfectmega-1_pin_39');
          setTimeout(() => {
            pin24ActivatedFinal = false;
          }, 2000);
        }
      },
      "disinfectmega-2_pin_25": () => {
        if (!pin25Activated1 && !main1Finished) {
          pin25Activated1 = true;
          if (narration2Interval !== null) {
            clearInterval(narration2Interval);
            narration2Interval = null;
          }
          narration2.pause();
          narration2.currentTime = 0;
          triggerPinOnAndOff('disinfectmega-1_pin_42');
          equip_2page.style.display = "none";
          section2.style.display = "flex";
          new Audio('./sound/effect/complete.mp3').play();
          triggerPinOff('disinfectmega-1_pin_30');
          triggerPinOff('disinfectmega-1_pin_31');
          triggerPinOff('disinfectmega-1_pin_49');
          setTimeout(() => {
            main1Finished = true;
          }, 2000);
        }

        if (!pin25Activated2 && main1Finished) {
          pin25Activated2 = true;
          setTimeout(() => {
            triggerPinOnAndOff('disinfectmega-1_pin_40');
            triggerPinOn('disinfectmega-1_pin_30');
            triggerPinOn('disinfectmega-1_pin_31');
            triggerPinOn('disinfectmega-1_pin_49');
            setTimeout(() => {
              if (narration2Interval !== null) return;
              narration2Interval = setInterval(() => {
                narration2.play();
                // narration2 끝나는 타이밍에 맞춰서 시간 조정
              }, 10000);
            }, 15000);
          }, 2000);
        }

        if (pin35Activated && !pin25ActivatedFinal) {
          pin25ActivatedFinal = true;
          triggerPinOnAndOff('disinfectmega-1_pin_42');
          setTimeout(() => {
            pin25ActivatedFinal = false;
          }, 2000);
        }
      },
      "disinfectmega-2_pin_26": () => {
        if (!pin26Activated) {
          pin26Activated = true;
          triggerPinOn('disinfectmega-1_pin_37');
          if (!pin23Activated) {
            pin23ActivatedOver = true;
            section1.style.display = "none";
            section2.style.display = "flex";
          }
          if (!pin24Activated1) {
            triggerPinOnAndOff('disinfectmega-1_pin_39');
            triggerPinOn('disinfectmega-1_pin_29');
            triggerPinOn('disinfectmega-1_pin_43');
            triggerPinOn('disinfectmega-1_pin_49');
            setTimeout(() => {
              new Audio('./sound/narration/narration1.ogg').play();
            }, 15000);
            setTimeout(() => {
              if (narration2Interval !== null) return;
              narration2Interval = setInterval(() => {
                narration2.play();
                // narration2 끝나는 타이밍에 맞춰서 시간 조정
              }, 10000);
              // narration1 끝나는 타이밍에 맞춰서 시간 조정
            }, 20000);
          }
        }
      },
      "disinfectmega-2_pin_27": () => {
        if (pin34Activated && !pin27Activated) {
          pin27Activated = true;
          triggerPinOnAndOff('disinfectmega-1_pin_39');
          new Audio('./sound/effect/complete.mp3').play();
          main3_complete2.style.display = "none";
          equip_2page.style.display = "flex";
          setTimeout(() => {
            if (narration2Interval !== null) return;
            narration2Interval = setInterval(() => {
              narration2.play();
              // narration2 끝나는 타이밍에 맞춰서 시간 조정
            }, 10000);
          }, 15000);
        }

        if (pin35Activated && !pin27ActivatedFinal) {
          pin27ActivatedFinal = true;
          triggerPinOnAndOff('disinfectmega-1_pin_39');
          setTimeout(() => {
            pin27ActivatedFinal = false;
          }, 2000);
        }
      },
      "disinfectmega-2_pin_28": () => {
        if (pin23ActivatedOver && !pin28Activated) {
          pin28Activated = true;
          if (narration2Interval !== null) {
            clearInterval(narration2Interval);
            narration2Interval = null;
          }
          narration2.pause();
          narration2.currentTime = 0;
          triggerPinOnAndOff('disinfectmega-1_pin_41');
          section2.style.display = "none";
          section3.style.display = "flex";
          new Audio('./sound/effect/complete.mp3').play();
          triggerPinOff('disinfectmega-1_pin_29');
          triggerPinOff('disinfectmega-1_pin_43');
          setTimeout(() => {
            new Audio('./sound/narration/narration10.ogg').play();
          }, 2000);
        }

        if (pin35Activated && !pin28ActivatedFinal) {
          pin28ActivatedFinal = true;
          triggerPinOnAndOff('disinfectmega-1_pin_41');
          setTimeout(() => {
            pin28ActivatedFinal = false;
          }, 2000);
        }
      },
      "disinfectmega-2_pin_29": () => {
        if (equipCleared && !pin29Activated) {
          pin29Activated = true;
          triggerPinOnAndOff('disinfectmega-1_pin_40');
          new Audio('./sound/effect/complete.mp3').play();
          equip_1page.style.display = "none";
          equip_2page.style.display = "flex";
          setTimeout(() => {
            if (narration2Interval !== null) return;
            narration2Interval = setInterval(() => {
              narration2.play();
              // narration2 끝나는 타이밍에 맞춰서 시간 조정
            }, 10000);
          }, 15000);
        }

        if (pin35Activated && !pin29ActivatedFinal) {
          pin29ActivatedFinal = true;
          triggerPinOnAndOff('disinfectmega-1_pin_40');
          setTimeout(() => {
            pin29ActivatedFinal = false;
          }, 2000);
        }
      },
      "disinfectmega-2_pin_30": () => {
        if (pin25Activated2 && !pin30Activated) {
          pin30Activated = true;
          if (narration2Interval !== null) {
            clearInterval(narration2Interval);
            narration2Interval = null;
          }
          narration2.pause();
          narration2.currentTime = 0;
          triggerPinOnAndOff('disinfectmega-1_pin_42');
          triggerPinOff('disinfectmega-1_pin_30');
          triggerPinOff('disinfectmega-1_pin_31');
          section2.style.display = "none";
          section3.style.display = "flex";
          new Audio('./sound/effect/complete.mp3').play();
        }

        if (pin35Activated && !pin30ActivatedFinal) {
          pin30ActivatedFinal = true;
          triggerPinOnAndOff('disinfectmega-1_pin_42');
          setTimeout(() => {
            pin30ActivatedFinal = false;
          }, 2000);
        }
      },
      "disinfectmega-2_pin_31": () => {
        if (!pin31Activated) {
          pin31Activated = true;
          new Audio('./sound/effect/operation.ogg').play();
        }
      },
      "disinfectmega-2_pin_32": () => {
        if (!pin32Activated) {
          pin32Activated = true;
          new Audio('./sound/effect/complete.mp3').play();
          main2_complete.style.display = "none";
          main2_complete2.style.display = "flex";
          new Audio('./sound/narration/narration11.ogg').play();
          setTimeout(() => {
            main2Finished = true;
            main2_complete2.style.display = "none";
            section3.style.display = "flex";
          }, 10000);
        }
      },
      "disinfectmega-2_pin_33": () => {
        if (!pin33Activated) {
          pin33Activated = true;
          triggerPinOn('disinfectmega-1_pin_23');
        }
      },
      "disinfectmega-2_pin_34": () => {
        if (!pin34Activated) {
          pin34Activated = true;
          quarnatine.pause();
          setTimeout(() => {
            new Audio('./sound/effect/complete.mp3').play();
            triggerPinOn('disinfectmega-1_pin_29');
            triggerPinOn('disinfectmega-1_pin_43');
            main3_complete.style.display = "none";
            main3_complete2.style.display = "flex";
          }, 1000);
          setTimeout(() => {
            new Audio('./sound/narration/narration15.ogg').play();
          }, 2000);
        }
      },
      "disinfectmega-2_pin_35": () => {
        if (!pin35Activated) {
          pin35Activated = true;
          triggerPinOn('disinfectmega-1_pin_29');
          triggerPinOn('disinfectmega-1_pin_30');
          triggerPinOn('disinfectmega-1_pin_31');
          triggerPinOn('disinfectmega-1_pin_43');
          triggerPinOn('disinfectmega-1_pin_49');
        }
      },
      "disinfectmega-2_pin_36": () => {
        if (!pin36Activated) {
          pin36Activated = true;
          triggerPinOnAndOff('disinfectmega-1_pin_25');
          triggerPinOnAndOff('disinfectmega-1_pin_26');
          triggerPinOnAndOff('disinfectmega-1_pin_27');
          triggerPinOnAndOff('disinfectmega-1_pin_28');
          triggerPinOff('disinfectmega-1_pin_22');
          triggerPinOff('disinfectmega-1_pin_23');
          triggerPinOff('disinfectmega-1_pin_24');
          triggerPinOff('disinfectmega-1_pin_29');
          triggerPinOff('disinfectmega-1_pin_30');
          triggerPinOff('disinfectmega-1_pin_31');
          triggerPinOff('disinfectmega-1_pin_32');
          triggerPinOff('disinfectmega-1_pin_37');
          triggerPinOff('disinfectmega-1_pin_38');
          triggerPinOff('disinfectmega-1_pin_39');
          triggerPinOff('disinfectmega-1_pin_40');
          triggerPinOff('disinfectmega-1_pin_41');
          triggerPinOff('disinfectmega-1_pin_42');
          triggerPinOff('disinfectmega-1_pin_43');
          triggerPinOff('disinfectmega-1_pin_47');
          triggerPinOff('disinfectmega-1_pin_48');
          triggerPinOff('disinfectmega-1_pin_49');
          setTimeout(() => {
            location.reload();
          }, 5000);
        }
      },

    };

    function updatePinDisplay(pinIdentifier) {
      if (pinActions[pinIdentifier] && window[pinIdentifier] === true) {
        pinActions[pinIdentifier]();
      }
    }
    setInterval(() => {
      Object.keys(pinActions).forEach(updatePinDisplay);
    }, 200);
    $('#section0').click(function () {
      section0.style.display = "none";
      section1.style.display = "flex";
    });
  </script>

  <script>
    $('#initialpage_button').click(function () {
      triggerPinOnAndOff('disinfectmega-1_pin_32');
    });

    let main1Finished = false;
    let main2Finished = false;
    $('#mainpage_button1').click(function () {
      if (!main1Finished) {
        new Audio('./sound/effect/complete.mp3').play();
        section3.style.display = "none";
        main1.style.display = "flex";
      } else {
        new Audio('./sound/effect/click.mp3').play();
        $('#warning-popup2').css('display', 'flex');
        new Audio('./sound/narration/narration8.ogg').play();
      }
    });
    $('#mainpage_button2').click(function () {
      if (!main1Finished) {
        new Audio('./sound/effect/click.mp3').play();
        $('#warning-popup1').css('display', 'flex');
        new Audio('./sound/narration/narration10.ogg').play();
      } else if (!main2Finished) {
        new Audio('./sound/effect/complete.mp3').play();
        triggerPinOnAndOff('disinfectmega-1_pin_22');
        section3.style.display = "none";
        main2.style.display = "flex";
      } else {
        new Audio('./sound/effect/click.mp3').play();
        $('#warning-popup4').css('display', 'flex');
        new Audio('./sound/narration/narration13.ogg').play();
      }
    });
    $('#mainpage_button3').click(function () {
      if (!main1Finished) {
        new Audio('./sound/effect/click.mp3').play();
        $('#warning-popup1').css('display', 'flex');
        new Audio('./sound/narration/narration10.ogg').play();
      } else if (!main2Finished) {
        new Audio('./sound/effect/click.mp3').play();
        $('#warning-popup3').css('display', 'flex');
        new Audio('./sound/narration/narration9.ogg').play();
      } else {
        section3.style.display = "none";
        main3.style.display = "flex";
      }
    });
    $('#warning-popup1').click(function () {
      new Audio('./sound/effect/click.mp3').play();
      $(this).css('display', 'none');
    });
    $('#warning-popup2').click(function () {
      new Audio('./sound/effect/click.mp3').play();
      $(this).css('display', 'none');
    });
    $('#warning-popup3').click(function () {
      new Audio('./sound/effect/click.mp3').play();
      $(this).css('display', 'none');
    });
    $('#warning-popup4').click(function () {
      new Audio('./sound/effect/click.mp3').play();
      $(this).css('display', 'none');
    });

    const buttons = document.querySelectorAll('.main-btn');
    buttons.forEach(button => {
      const baseName = button.dataset.base;
      button.addEventListener('mousedown', () => {
        button.src = `./img/${baseName}_onclick.png`;
      });
      const restore = () => {
        button.src = `./img/${baseName}.png`;
      };
      button.addEventListener('mouseup', restore);
      button.addEventListener('mouseleave', restore);
      button.addEventListener('touchstart', () => {
        button.src = `./img/${baseName}_onclick.png`;
      });
      button.addEventListener('touchend', restore);
    });

    const main1Buttons = document.querySelectorAll('.main1-btn');
    const requiredIds = [
      'itemvault_button_1-2',
      'itemvault_button_2-1',
      'itemvault_button_2-2',
      'itemvault_button_3-1'
    ];
    main1Buttons.forEach(button => {
      const baseName = button.dataset.base;
      button.addEventListener('click', () => {
        if (button.src.includes(`${baseName}_onclick.png`)) {
          button.src = `./img/${baseName}.png`;
        } else {
          button.src = `./img/${baseName}_onclick.png`;
        }
        new Audio('./sound/effect/click.mp3').play();
        let allRequiredOn = requiredIds.every(id => {
          const el = document.getElementById(id);
          return el.src.includes(`${id}_onclick.png`);
        });
        let anyOthersOn = Array.from(main1Buttons).some(el => {
          if (!requiredIds.includes(el.id)) {
            return el.src.includes(`${el.dataset.base}_onclick.png`);
          }
          return false;
        });
        if (allRequiredOn && !anyOthersOn) {
          new Audio('./sound/effect/complete.mp3').play();
          main1.style.display = "none";
          equip_1page.style.display = "flex";
          setTimeout(() => {
            new Audio('./sound/narration/narration6.ogg').play();
          }, 2000);
          setTimeout(() => {
            new Audio('./sound/narration/narration6.ogg').play();
            triggerPinOn('disinfectmega-1_pin_30');
            triggerPinOn('disinfectmega-1_pin_31');
            triggerPinOn('disinfectmega-1_pin_47');
            equipCleared = true;
          }, 2000);
        }
      });
    });

    $('#itemdisinfect_button').click(function () {
      new Audio('./sound/effect/click.mp3').play();
      $(this).attr('src', './img/itemdisinfect_button_onclick.png');
      setTimeout(() => {
        new Audio('./sound/effect/complete.mp3').play();
        main2.style.display = "none";
        main2_complete.style.display = "flex";
        triggerPinOnAndOff('disinfectmega-1_pin_22');
      }, 1000);
      setTimeout(() => {
        new Audio('./sound/effect/poweron.ogg').play();
      }, 1500);
      setTimeout(() => {
        new Audio('./sound/narration/narration10.ogg').play();
      }, 8000);
    });
    $('#itemdisinfect_button2').click(function () {
      new Audio('./sound/effect/click.mp3').play();
      $(this).attr('src', './img/itemdisinfect_button_onclick.png');
      setTimeout(() => {
        new Audio('./sound/effect/complete.mp3').play();
        main3.style.display = "none";
        main3_complete.style.display = "flex";
        triggerPinOnAndOff('disinfectmega-1_pin_24');
      }, 1000);
      setTimeout(() => {
        new Audio('./sound/narration/narration14.ogg').play();
      }, 1500);
      setTimeout(() => {
        quarnatine.play();
      }, 10000);
    });
  </script>

  <script src="../script.js"></script>
</body>

</html>